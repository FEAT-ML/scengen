<!-- SPDX-FileCopyrightText: 2023 German Aerospace Center <amiris@dlr.de>

SPDX-License-Identifier: Apache-2.0 -->

[![PyPI version](https://badge.fury.io/py/scengen.svg)](https://badge.fury.io/py/scengen)
[![PyPI license](https://img.shields.io/pypi/l/scengen.svg)](https://badge.fury.io/py/scengen)

# scengen
`scengen` is a scenario generator for the open electricity market model [AMIRIS](https://dlr-ve.gitlab.io/esy/amiris/home/).

## Installation

    pip install scengen

You may also use `pipx`. For detailed information please refer to the official `pipx` [documentation](https://github.com/pypa/pipx).

    pipx install scengen


### Further Requirements
In order to execute `scengen` correctly, you also require a Java Development Kit (JDK).
JDK must be installed and accessible via your console in which you run `scengen`. 

To test, run `java --version` which should show your JDK version (required: 8 or above).
If `java` command is not found or relates to a Java Runtime Environment (JRE), please download and install JDK (e.g. from [Adoptium](https://adoptium.net/de/temurin/releases/?version=11))


## Usage
Currently, there is one command available:

- `scengen create`: Creates scenarios for AMIRIS

### `scengen create`
Creates AMIRIS scenarios based on user defined input, estimates their plausibility, executes them by calling AMIRIS, and evaluates their final performance.  

| Option                | Action                                                                              |
|-----------------------|-------------------------------------------------------------------------------------|
| `-n` or `--number`    | Specify number of scenarios to be generated                                         |
| `-c` or `--config`    | Path to `configuration` YAML file defining specifications for creation of scenarios |
| `-j` or `--jar`       | Path to `amiris-core_<version>-jar-with-dependencies.jar`                           |
| `-d` or `--directory` | Directory to parse scenarios from and write results to                              |

The procedure, handled by the `workflow.py`, is as follows:

1. A `scenario.yaml` is generated by the `generator.py` (see detailed explanation of the `configuration.yaml`)
2. AMIRIS is called by the `runner.py` to run the simulation of `scenario.yaml`
3. The `evaluator.py` checks if the number of scarcity hours in the calculated simulation falls within a defined share and returns a positive boolean if so
4. The next scenario generation is triggered if previous evaluation was negative, or the number of requested scenarios is not yet met

#### Relevant Files

##### `configuration` YAML
This file is mandatory and defines the main inputs for the creation of new scenarios.
It has the following format with all paths relative to this particular file.

```yaml
defaults:  # defaults used for scenario generation
  seed: 42  # seed used for random number generation
  trace_file: "./tracefile.yaml"  # file used to log created scenarios avoiding duplicates
  base_name: "Germany2019"  # first part of name created by generator; second part of name is unique identifier (number of all scenarios)

base_template: "./template.yaml"  # link to template file containing at least Schema & GeneralProperties

create:  # list of agents to create
  - type_template: "EnergyExchange.yaml"  # file containing agent definition(s) and contract(s) with agents in same group or pre-defined agents
    count: [1, 1]  # min / max
    ids: 
      exchange: "energyExchangeDE"  # temporary name of this agent for auto-connecting to other agents
      
  - type_template: "EnergyExchange.yaml"  # file containing agent definition(s) and contract(s) with agents in same group or pre-defined agents
    count: [1, 1]  # min / max
    ids: 
      exchange: "energyExchangeFR"  # temporary name of this agent for auto-connecting to other agents    
    
  - type_template: "DemandTrader.yaml"
    count: [1, 2]
    ids: ["demandTrader"]
    external_ids:  # link to other dynamically create agents by name
      exchange: "energyExchangeDE"  # dynamically linked to newly created agent referenced herein as "energyExchangeDE"
      forecast: 6  # fixed id used in base_template

  - type_template: "DemandTrader.yaml"
    count: [1, 2]
    ids: ["demandTrader"]
    external_ids:  # link to other dynamically create agents by name
      exchange: "energyExchangeFR"  # dynamically linked to newly created agent referenced herein as "energyExchangeFR"
      forecast: 6  # fixed id used in base_template
```

##### `trace_file` YAML
The `trace_file` is specified as relative path in the `generation` file. 
Its purpose is to keep track of all created scenario configurations, which ensures that no duplicates are generated.
The `total_count` gets increased by 1, if the generated scenario passed all stages in the workflow (estimation and evaluation).

Its format is as follows:

```yaml
total_count: 2  # number of all scenarios generated
```

### Help
You reach the help menu at any point using `-h` or `--help` which gives you a list of all available options, e.g.:

`scengen --help`


## Cite 
If you use scengen for academic work, please cite:

Christoph Schimeczek, Kristina Nienhaus, Ulrich Frey, Evelyn Sperber, Seyedfarzad Sarfarazi, Felix Nitsch, Johannes Kochems & A. Achraf El Ghazi (2023). AMIRIS: Agent-based Market model for the Investigation of Renewable and Integrated energy Systems. Journal of Open Source Software. doi: [10.21105/joss.05041](https://doi.org/10.21105/joss.05041)

and 

Felix Nitsch, Ulrich Frey, Christoph Schimeczek (2023). scengen: A scenario generator for the open electricity market model AMIRIS. GitHub. https://github.com/FEAT-ML/scenario-generator 


## Contributing
Please see [CONTRIBUTING](CONTRIBUTING.md).

## Available Support
This is a purely scientific project by (at the moment) one research group. 
Thus, there is no paid technical support available.

If you experience any trouble with `scengen` or AMIRIS, you may contact the developers at the [openMod-Forum](https://forum.openmod.org/tag/amiris) or via [amiris@dlr.de](mailto:amiris@dlr.de).
Please report bugs and make feature requests by filing issues following the provided templates (see also [CONTRIBUTING](CONTRIBUTING.md)).
For substantial enhancements, we recommend that you contact us via [amiris@dlr.de](mailto:amiris@dlr.de) for working together on the code in common projects or towards common publications and thus further develop AMIRIS.
